{"openapi":"3.1.0","info":{"title":"Autonomous Hydroponic Plant API","description":"REST API to control and monitor the ZombiePlant V1.0 hydroponic system.","version":"1.1"},"paths":{"/tools/feed":{"post":{"tags":["Tools"],"summary":"Smart Feed Cycle","description":"Performs a complete drain-refill-mix cycle with nutrient dosing.\n1. Empty Tank.\n2. Dose Nutrients (Micro/Gro/Bloom).\n3. Fill to Max with fresh water.\n4. Mix (Air Stones/Light ON) for 3 minutes.\n5. Verify TDS.","operationId":"smart_feed_cycle_tools_feed_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/tools/dose":{"post":{"tags":["Tools"],"summary":"Smart Dose","description":"Precise nutrient addition without draining the tank.\n1. Dispenses specific nutrient amount.\n2. Mixes (Air Stones) for specified duration.\n3. Returns new TDS reading.","operationId":"smart_dose_tools_dose_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DoseRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DoseResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/tools/flush":{"post":{"tags":["Tools"],"summary":"True System Flush","description":"Performs a full system flush (Rinse Cycle).\n1. Empty Tank.\n2. Fill to Max (Fresh Water).\n3. Soak/Mix (Air Stones ON) for X seconds.\n4. Empty Tank (Drain Rinse).\n5. Fill to Max (Fresh Water).","operationId":"true_system_flush_tools_flush_post","parameters":[{"name":"soak_duration","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"Duration in seconds to run the air stones/mix cycle.","default":180,"title":"Soak Duration"},"description":"Duration in seconds to run the air stones/mix cycle."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlushResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/tools/diagnose":{"post":{"tags":["Tools"],"summary":"Diagnostic Self Check","description":"Performs a daily health check for the hardware.\n1. Checks Sensor bounds (pH, TDS, Environment).\n2. Runs a pump briefly and verifies operation via Microphone analysis.\n3. Returns a structured health report.","operationId":"diagnostic_self_check_tools_diagnose_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DiagnosticResponse"}}}}}}},"/jobs/":{"post":{"tags":["Jobs"],"summary":"Submit Job","description":"Submit a new background job.\nReturns the initial job status (queued).","operationId":"submit_job_jobs__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobRequest"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobStatus"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{job_id}":{"get":{"tags":["Jobs"],"summary":"Get Job Status","description":"Get the status of a specific job.","operationId":"get_job_status_jobs__job_id__get","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","description":"The ID of the job to retrieve","title":"Job Id"},"description":"The ID of the job to retrieve"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobStatus"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Jobs"],"summary":"Cancel Job","description":"Cancel a running or queued job.","operationId":"cancel_job_jobs__job_id__delete","parameters":[{"name":"job_id","in":"path","required":true,"schema":{"type":"string","title":"Job Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/":{"get":{"tags":["System"],"summary":"Read Root","description":"Returns the current status and system version.","operationId":"read_root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/StatusResponse"}}}}}}},"/control/pump":{"post":{"tags":["Control"],"summary":"Control Pump","description":"Manually dispense from a specific pump for a given duration.","operationId":"control_pump_control_pump_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PumpCommand"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PumpResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/control/ac_relay":{"post":{"tags":["Control"],"summary":"Control Ac Relay","description":"Turn AC Power 'on' or 'off' for devices like the main grow light.","operationId":"control_ac_relay_control_ac_relay_post","parameters":[{"name":"state","in":"query","required":true,"schema":{"$ref":"#/components/schemas/RelayState","description":"The desired state for the AC power."},"description":"The desired state for the AC power."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ACRelayResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/hardware/status":{"get":{"tags":["Status"],"summary":"Hardware Status","description":"Retrieves the current status of all connected hardware.","operationId":"hardware_status_hardware_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HardwareStatusResponse"}}}}}}},"/hardware/status/html":{"get":{"tags":["Status"],"summary":"Hardware Status Html","description":"Returns a self-refreshing HTML page with hardware status.","operationId":"hardware_status_html_hardware_status_html_get","responses":{"200":{"description":"Successful Response","content":{"text/html":{"schema":{"type":"string"}}}}}}},"/control/fill_to_max":{"post":{"tags":["Control"],"summary":"Fill To Max","description":"Fills the tank to the maximum level and adjusts for overflow prevention.\nActivates Pump 2 (Water In) until the top float switch triggers,\nthen briefly activates Pump 1 (Water Out) until the switch releases.","operationId":"fill_to_max_control_fill_to_max_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FillResponse"}}}}}}},"/control/empty_tank":{"post":{"tags":["Control"],"summary":"Empty Tank","description":"Empties the tank using the main water out pump.\nActivates Pump 1 (Water Out) until the bottom float switch indicates empty.","operationId":"empty_tank_control_empty_tank_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmptyResponse"}}}}}}},"/control/system_flush":{"post":{"tags":["Control"],"summary":"System Flush","description":"Performs a full system flush and nutrient pump priming cycle.\n1. Primes all 3 nutrient pumps.\n2. Fills the tank.\n3. Empties the tank.\n4. Fills the tank again.","operationId":"system_flush_control_system_flush_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlushResponse"}}}}}}},"/control/fix_overflow":{"post":{"tags":["Control"],"summary":"Fix Overflow Endpoint","description":"Manually triggers the overflow fix logic.","operationId":"fix_overflow_endpoint_control_fix_overflow_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SuccessResponse"}}}}}}},"/sensors/ph":{"get":{"tags":["Sensors"],"summary":"Read Ph","description":"Reads the current pH level and raw voltage from the sensor.","operationId":"read_ph_sensors_ph_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PHStatus"}}}}}}},"/sensors/camera/capture":{"get":{"tags":["Sensors"],"summary":"Capture a standard photo","description":"Captures an image with default camera settings.","operationId":"capture_photo_sensors_camera_capture_get","parameters":[{"name":"autofocus_mode","in":"query","required":false,"schema":{"type":"string","description":"Autofocus mode: default, manual, continuous","title":"Autofocus Mode"},"description":"Autofocus mode: default, manual, continuous"},{"name":"lens_position","in":"query","required":false,"schema":{"type":"number","description":"Lens position for manual focus (0.0 - infinity)","title":"Lens Position"},"description":"Lens position for manual focus (0.0 - infinity)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}},"image/jpeg":{}}},"500":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CameraErrorResponse"}}},"description":"Internal Server Error"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/sensors/camera/plant":{"get":{"tags":["Sensors"],"summary":"Capture a photo with grow light ON","description":"Captures an image with the main light (AC Relay) turned ON.\nTuned for bright light: Lowers EV and Saturation.","operationId":"capture_plant_photo_sensors_camera_plant_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}},"image/jpeg":{}}},"500":{"description":"Internal Server Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/CameraErrorResponse"}}}}}}},"/sensors/microphone/record":{"get":{"tags":["Sensors"],"summary":"Record a short audio clip","description":"Records an audio clip, useful for detecting pump/system noises.","operationId":"record_audio_sensors_microphone_record_get","parameters":[{"name":"duration","in":"query","required":false,"schema":{"type":"integer","maximum":30,"exclusiveMinimum":0,"description":"Recording duration in seconds.","default":5,"title":"Duration"},"description":"Recording duration in seconds."}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}},"audio/wav":{}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/timelapse/latest":{"get":{"tags":["Timelapse"],"summary":"Get the latest timelapse video","description":"Returns the latest generated timelapse video.","operationId":"get_latest_timelapse_timelapse_latest_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}},"video/mp4":{}}},"404":{"description":"No video found"}}}}},"components":{"schemas":{"ACRelayResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"ac_power":{"$ref":"#/components/schemas/RelayState"}},"type":"object","required":["ac_power"],"title":"ACRelayResponse"},"CameraErrorResponse":{"properties":{"error":{"type":"string","const":"Capture failed","title":"Error"}},"type":"object","required":["error"],"title":"CameraErrorResponse"},"DHTError":{"properties":{"error":{"type":"string","title":"Error"}},"type":"object","required":["error"],"title":"DHTError"},"DHTSuccess":{"properties":{"temperature_f":{"type":"number","title":"Temperature F","description":"Temperature in Fahrenheit"},"humidity_percent":{"type":"number","title":"Humidity Percent","description":"Relative Humidity in percent"}},"type":"object","required":["temperature_f","humidity_percent"],"title":"DHTSuccess"},"DiagnosticResponse":{"properties":{"status":{"type":"string","enum":["healthy","warning","error"],"title":"Status"},"sensors":{"additionalProperties":{"$ref":"#/components/schemas/SensorCheckResult"},"type":"object","title":"Sensors"},"pumps":{"$ref":"#/components/schemas/PumpCheckResult"}},"type":"object","required":["status","sensors","pumps"],"title":"DiagnosticResponse"},"DoseRequest":{"properties":{"nutrient":{"$ref":"#/components/schemas/PumpID","description":"The nutrient pump to activate (flora_micro, flora_gro, flora_bloom)."},"amount_ml":{"type":"number","exclusiveMinimum":0.0,"title":"Amount Ml","description":"Amount of nutrient to dispense in mL."},"mix_seconds":{"type":"integer","minimum":0.0,"title":"Mix Seconds","description":"Duration to run air stones for mixing after dosing.","default":30}},"type":"object","required":["nutrient","amount_ml"],"title":"DoseRequest"},"DoseResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"message":{"type":"string","title":"Message"},"nutrient":{"$ref":"#/components/schemas/PumpID"},"amount_dispensed_ml":{"type":"number","title":"Amount Dispensed Ml"},"final_tds":{"type":"number","title":"Final Tds"}},"type":"object","required":["message","nutrient","amount_dispensed_ml","final_tds"],"title":"DoseResponse"},"EmptyResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"message":{"type":"string","title":"Message"},"duration":{"type":"number","title":"Duration"}},"type":"object","required":["message","duration"],"title":"EmptyResponse"},"FeedRequest":{"properties":{"recipe":{"$ref":"#/components/schemas/NutrientRecipe","description":"Nutrient recipe to apply."},"amounts_ml":{"anyOf":[{"additionalProperties":{"type":"number"},"type":"object"},{"type":"null"}],"title":"Amounts Ml","description":"Custom nutrient amounts in mL (required if recipe is custom). Keys: micro, gro, bloom."}},"type":"object","required":["recipe"],"title":"FeedRequest"},"FeedResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"message":{"type":"string","title":"Message"},"recipe":{"$ref":"#/components/schemas/NutrientRecipe"},"amounts_dispensed":{"additionalProperties":{"type":"number"},"type":"object","title":"Amounts Dispensed"},"final_tds":{"type":"number","title":"Final Tds"}},"type":"object","required":["message","recipe","amounts_dispensed","final_tds"],"title":"FeedResponse"},"FillResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"message":{"type":"string","title":"Message"},"fill_duration":{"type":"number","title":"Fill Duration"},"adjust_duration":{"type":"number","title":"Adjust Duration"}},"type":"object","required":["message","fill_duration","adjust_duration"],"title":"FillResponse"},"FlushResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"message":{"type":"string","title":"Message"},"final_fill_details":{"$ref":"#/components/schemas/FillResponse"}},"type":"object","required":["message","final_fill_details"],"title":"FlushResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HardwareStatusResponse":{"properties":{"pumps":{"additionalProperties":{"type":"integer"},"propertyNames":{"$ref":"#/components/schemas/PumpID"},"type":"object","title":"Pumps","description":"Current state of each pump (0=OFF, 1=ON)."},"ac_power":{"$ref":"#/components/schemas/RelayState","description":"Current state of the AC power relay."},"water_level":{"$ref":"#/components/schemas/WaterLevelStatus"},"tds":{"$ref":"#/components/schemas/TDSStatus"},"ph":{"$ref":"#/components/schemas/PHStatus"},"environment":{"anyOf":[{"$ref":"#/components/schemas/DHTSuccess"},{"$ref":"#/components/schemas/DHTError"}],"title":"Environment","description":"Air temperature and humidity."}},"type":"object","required":["pumps","ac_power","water_level","tds","ph","environment"],"title":"HardwareStatusResponse"},"JobRequest":{"properties":{"type":{"$ref":"#/components/schemas/JobType"},"params":{"anyOf":[{"additionalProperties":{"anyOf":[{"type":"string"},{"type":"number"},{"type":"integer"},{"additionalProperties":true,"type":"object"}]},"type":"object"},{"type":"null"}],"title":"Params","description":"Parameters for the job (e.g., recipe for feed)."}},"type":"object","required":["type"],"title":"JobRequest"},"JobState":{"type":"string","enum":["queued","running","completed","failed"],"title":"JobState"},"JobStatus":{"properties":{"job_id":{"type":"string","title":"Job Id"},"type":{"$ref":"#/components/schemas/JobType"},"status":{"$ref":"#/components/schemas/JobState"},"created_at":{"type":"number","title":"Created At"},"started_at":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Started At"},"completed_at":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Completed At"},"result":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"string"},{"$ref":"#/components/schemas/FillResponse"},{"$ref":"#/components/schemas/EmptyResponse"},{"$ref":"#/components/schemas/FlushResponse"},{"$ref":"#/components/schemas/FeedResponse"},{"$ref":"#/components/schemas/DiagnosticResponse"},{"type":"null"}],"title":"Result"},"error":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error"}},"type":"object","required":["job_id","type","status","created_at"],"title":"JobStatus"},"JobType":{"type":"string","enum":["fill_to_max","empty_tank","system_flush","feed","diagnose"],"title":"JobType"},"NutrientRecipe":{"type":"string","enum":["vegetative","flowering","custom"],"title":"NutrientRecipe"},"PHStatus":{"properties":{"ph":{"type":"number","title":"Ph","description":"Calculated pH level (0-14)."},"voltage":{"type":"number","title":"Voltage","description":"Raw voltage reading from the sensor."}},"type":"object","required":["ph","voltage"],"title":"PHStatus"},"PumpCheckResult":{"properties":{"passed":{"type":"boolean","title":"Passed"},"pump_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Pump Id"},"noise_level":{"type":"number","title":"Noise Level"},"message":{"type":"string","title":"Message"}},"type":"object","required":["passed","noise_level","message"],"title":"PumpCheckResult"},"PumpCommand":{"properties":{"pump_id":{"$ref":"#/components/schemas/PumpID","description":"The unique identifier for the pump."},"duration":{"type":"number","exclusiveMinimum":0.0,"title":"Duration","description":"Duration in seconds for which to run the pump.","example":5.5}},"type":"object","required":["pump_id","duration"],"title":"PumpCommand"},"PumpID":{"type":"string","enum":["water_out","water_in","flora_micro","flora_gro","flora_bloom"],"title":"PumpID"},"PumpResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"},"pump":{"$ref":"#/components/schemas/PumpID"},"duration":{"type":"number","title":"Duration"}},"type":"object","required":["pump","duration"],"title":"PumpResponse"},"RelayState":{"type":"string","enum":["on","off"],"title":"RelayState"},"SensorCheckResult":{"properties":{"passed":{"type":"boolean","title":"Passed"},"value":{"anyOf":[{"type":"number"},{"additionalProperties":true,"type":"object"},{"type":"string"}],"title":"Value"},"message":{"type":"string","title":"Message"}},"type":"object","required":["passed","value","message"],"title":"SensorCheckResult"},"StatusResponse":{"properties":{"status":{"type":"string","title":"Status","example":"Online"},"system":{"type":"string","title":"System","example":"ZombiePlant V1.0"}},"type":"object","required":["status","system"],"title":"StatusResponse"},"SuccessResponse":{"properties":{"status":{"type":"string","const":"success","title":"Status","default":"success"}},"type":"object","title":"SuccessResponse"},"TDSStatus":{"properties":{"ppm":{"type":"number","title":"Ppm","description":"Total Dissolved Solids in parts per million."},"voltage":{"type":"number","title":"Voltage","description":"Raw voltage reading from the sensor."}},"type":"object","required":["ppm","voltage"],"title":"TDSStatus"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"WaterLevelStatus":{"properties":{"full":{"type":"boolean","title":"Full","description":"True if the top float switch is triggered."},"empty":{"type":"boolean","title":"Empty","description":"True if the bottom float switch is triggered."}},"type":"object","required":["full","empty"],"title":"WaterLevelStatus"}}}}